<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>Manage Reservations - Test  Delight</title>
    <th:block layout:fragment="head">
        <style>
            .reservation-card {
                border-left: 4px solid var(--primary-color);
                margin-bottom: 1rem;
                transition: all 0.3s;
            }
            .reservation-card:hover {
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            }
            .reservation-card.confirmed {
                border-left-color: #28a745;
            }
            .reservation-card.pending {
                border-left-color: #ffc107;
            }
            .reservation-time {
                font-size: 1.1rem;
                font-weight: 600;
            }
            .reservation-date {
                color: #6c757d;
                font-size: 0.9rem;
            }
            .badge-confirmed {
                background-color: #28a745;
            }
            .badge-pending {
                background-color: #ffc107;
                color: #212529;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <!-- Hero Section -->
        <section class="py-5 bg-light">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h1 class="mb-0">Manage Reservations</h1>
                    <a href="/reservations" class="btn btn-primary">New Reservation</a>
                </div>
            </div>
        </section>

        <!-- Reservations List -->
        <section class="py-5">
            <div class="container">
                <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
                <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="h5 mb-0">Upcoming Reservations</h2>
                            </div>
                            <div class="card-body">
                                <div th:if="${reservations != null && !reservations.empty}">
                                    <div th:each="reservation : ${reservations}" 
                                         th:class="'card mb-3 reservation-card ' + (${reservation.confirmed} ? 'confirmed' : 'pending')">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <div class="d-flex align-items-center mb-2">
                                                        <span class="reservation-time me-3" 
                                                              th:text="${#temporals.format(reservation.reservationTime, 'h:mm a')}">
                                                            7:00 PM
                                                        </span>
                                                        <span th:class="'badge ' + (${reservation.confirmed} ? 'badge-confirmed' : 'badge-pending')">
                                                            <span th:text="${reservation.confirmed} ? 'Confirmed' : 'Pending'"></span>
                                                        </span>
                                                    </div>
                                                    <h5 class="card-title mb-1" th:text="${reservation.customerName}">John Doe</h5>
                                                    <p class="card-text mb-1">
                                                        <span th:text="${reservation.numberOfPeople} + ' ' + ${reservation.numberOfPeople == 1 ? 'person' : 'people'}">
                                                            2 people
                                                        </span>
                                                        <span class="mx-2">•</span>
                                                        <span class="reservation-date" 
                                                              th:text="${#temporals.format(reservation.reservationDate, 'EEEE, MMMM d, yyyy')}">
                                                            Friday, June 10, 2023
                                                        </span>
                                                    </p>
                                                    <p class="card-text text-muted mb-0" th:if="${reservation.specialRequests}">
                                                        <small th:text="'Special requests: ' + ${reservation.specialRequests}">
                                                            Special requests: Window seat preferred
                                                        </small>
                                                    </p>
                                                </div>
                                                <div class="btn-group">
                                                    <a th:href="'tel:' + ${reservation.phone}" class="btn btn-outline-secondary btn-sm me-1">
                                                        <i class="fas fa-phone"></i>
                                                    </a>
                                                    <a th:href="'mailto:' + ${reservation.email}" class="btn btn-outline-secondary btn-sm me-1">
                                                        <i class="fas fa-envelope"></i>
                                                    </a>
                                                    <form th:if="!${reservation.confirmed}" 
                                                          th:action="'/reservations/' + ${reservation.id} + '/confirm'" 
                                                          method="post" class="d-inline">
                                                        <button type="submit" class="btn btn-success btn-sm me-1" 
                                                                title="Confirm Reservation">
                                                            <i class="fas fa-check"></i>
                                                        </button>
                                                    </form>
                                                    <form th:action="'/reservations/' + ${reservation.id} + '/cancel'" 
                                                          method="post" class="d-inline">
                                                        <button type="submit" class="btn btn-danger btn-sm" 
                                                                title="Cancel Reservation"
                                                                onclick="return confirm('Are you sure you want to cancel this reservation?')">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div th:if="${reservations == null || reservations.empty}" class="text-center py-5">
                                    <i class="far fa-calendar-alt fa-4x text-muted mb-3"></i>
                                    <h3>No Upcoming Reservations</h3>
                                    <p class="lead">There are no upcoming reservations at the moment.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h2 class="h5 mb-0">Today's Reservations</h2>
                            </div>
                            <div class="card-body">
                                <div th:if="${todaysReservations != null && !todaysReservations.empty}">
                                    <div th:each="reservation : ${todaysReservations}" class="mb-3 pb-3 border-bottom">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong th:text="${reservation.customerName}">John Doe</strong>
                                                <div class="text-muted small" 
                                                     th:text="${#temporals.format(reservation.reservationTime, 'h:mm a')} + ' • ' + ${reservation.numberOfPeople} + ' ' + ${reservation.numberOfPeople == 1 ? 'person' : 'people'}">
                                                    7:00 PM • 2 people
                                                </div>
                                            </div>
                                            <span th:class="'badge ' + (${reservation.confirmed} ? 'badge-confirmed' : 'badge-pending')">
                                                <span th:text="${reservation.confirmed} ? 'Confirmed' : 'Pending'"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div th:if="${todaysReservations == null || todaysReservations.empty}" class="text-center py-3">
                                    <p class="text-muted mb-0">No reservations for today</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h2 class="h5 mb-0">Quick Stats</h2>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-3">
                                    <div class="text-center">
                                        <div class="h3 mb-0" th:text="${totalReservations}">0</div>
                                        <small class="text-muted">Total</small>
                                    </div>
                                    <div class="text-center">
                                        <div class="h3 mb-0 text-success" th:text="${confirmedReservations}">0</div>
                                        <small class="text-muted">Confirmed</small>
                                    </div>
                                    <div class="text-center">
                                        <div class="h3 mb-0 text-warning" th:text="${pendingReservations}">0</div>
                                        <small class="text-muted">Pending</small>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="/reservations/export" class="btn btn-outline-secondary btn-sm w-100">
                                        <i class="fas fa-download me-1"></i> Export to Excel
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
